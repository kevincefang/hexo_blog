---
title: volatile的实现原理
date: 2017-11-13 17:30:10
tags: 
- java
- jvm
- 面试
categories: java
---

##### 将volatile修饰的java代码转换成汇编代码，进行写操作的时候会多出以lock前缀的汇编代码。lock前缀的指令在多核处理器下会引发两点：

1. 将当前处理器缓存行的数据写回到系统内存。
2. 这个写回内存的操作会使在其他CPU里缓存了该内存地址的数据无效。

##### volatile的两条实现原则：

1. Lock前缀指令会引起处理器缓存回写到内存。
2. 一个处理器的缓存回写到内存会导致其他处理器的缓存无效。


##### 锁的状态：

锁的级别从低到高依次是：`无锁状态` -> `偏向锁状态` -> `轻量级锁状态` -> `重量级锁状态`

> 这几个状态随着竞争情况逐渐升级,锁可以升级但不能降级,意味着偏向锁升级成轻量级锁后不能降级偏向锁,

